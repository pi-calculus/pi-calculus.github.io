<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sri Lankan History Timeline</title>
  <!-- Vis Timeline and Fuse.js -->
  <link rel="stylesheet" href="https://unpkg.com/vis-timeline/styles/vis-timeline-graph2d.min.css" />
  <script src="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <!-- Google Fonts and Font Awesome -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

  <style>
    /* CSS Variables for Light and Dark Themes */
    :root {
      --primary: #2A5C82;
      --secondary: #FF6B6B;
      --accent: #4ECDC4;
      --background: #f8f9fa;
      --text: #2d3436;
      --card-bg: #ffffff;
    }

    [data-theme="dark"] {
      --primary: #4ECDC4;
      --secondary: #FF6B6B;
      --background: #1a1a1a;
      --text: #ffffff;
      --card-bg: #2d2d2d;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--background);
      color: var(--text);
      transition: background 0.3s ease, color 0.3s ease;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 20px auto;
      background: var(--card-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      font-weight: 600;
      font-size: 2.5rem;
      background: linear-gradient(45deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Search & Filter Section */
    .search-filter-section {
      background: rgba(42, 92, 130, 0.05);
      padding: 1.5rem;
      border-radius: 1rem;
      margin-bottom: 2rem;
    }

    .search-wrapper {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .search-box {
      width: 100%;
      padding: 1rem 1rem 1rem 3rem;
      border: 2px solid rgba(42, 92, 130, 0.1);
      border-radius: 0.75rem;
      font-size: 1rem;
      background: var(--card-bg);
      color: var(--text);
      transition: all 0.3s ease;
    }

    .search-box:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(42, 92, 130, 0.2);
      outline: none;
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(45, 52, 54, 0.5);
    }

    .filter-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .filter-controls select,
    .filter-controls input[type="date"] {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid rgba(42, 92, 130, 0.1);
      border-radius: 0.75rem;
      background: var(--card-bg);
      color: var(--text);
      font-size: 1rem;
      appearance: none;
      transition: all 0.3s ease;
    }

    .filter-controls select:focus,
    .filter-controls input[type="date"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(42, 92, 130, 0.2);
      outline: none;
    }

    .reset-search-button {
      background: var(--secondary);
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: transform 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .reset-search-button:hover {
      transform: translateY(-2px);
    }

    /* Timeline Controls */
    .timeline-controls {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .control-button {
      background: var(--primary);
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .control-button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Timeline Container */
    #timeline {
      height: 500px;
      border-radius: 1rem;
      overflow: hidden;
      border: 2px solid rgba(42, 92, 130, 0.1);
      background: var(--card-bg);
    }

    /* Standard Timeline (Ordered List) */
    .standard-timeline {
      margin-top: 3rem;
    }

    .standard-timeline h2 {
      margin-bottom: 1rem;
      text-align: center;
    }

    .standard-timeline ol {
      list-style: decimal;
      margin-left: 20px;
      padding-left: 0;
    }

    .standard-timeline li {
      margin-bottom: 0.75rem;
      cursor: pointer;
      padding: 0.5rem;
      border-bottom: 1px solid rgba(42, 92, 130, 0.1);
    }

    .standard-timeline li:hover {
      background: rgba(42, 92, 130, 0.05);
    }

    /* Modal for Event Details */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    .event-details-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      max-width: 600px;
      width: 90%;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
      color: var(--primary);
    }

    .close-modal {
      cursor: pointer;
      font-size: 1.5rem;
    }

    .modal-date {
      color: var(--accent);
      margin: 1rem 0;
    }

    .modal-description {
      line-height: 1.6;
      color: rgba(var(--text), 0.8);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 15px;
      }
      #timeline {
        height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Sri Lankan History Timeline</h1>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" class="search-box" placeholder="Search historical events..." />
      </div>
      <div class="filter-controls">
        <select id="categoryFilter">
          <option value="">All Categories</option>
          <option value="political">Political</option>
          <option value="cultural">Cultural</option>
          <option value="economic">Economic</option>
        </select>
        <input type="date" id="startDate" placeholder="Start Date" />
        <input type="date" id="endDate" placeholder="End Date" />
      </div>
      <button class="reset-search-button" onclick="resetSearchFilters()">
        <i class="fas fa-undo"></i>
        Reset Filters
      </button>
    </div>

    <!-- Timeline Controls -->
    <div class="timeline-controls">
      <button class="control-button" onclick="zoomIn()">
        <i class="fas fa-search-plus"></i>
        Zoom In
      </button>
      <button class="control-button" onclick="zoomOut()">
        <i class="fas fa-search-minus"></i>
        Zoom Out
      </button>
      <button class="control-button" onclick="resetView()">
        <i class="fas fa-expand"></i>
        Reset View
      </button>
    </div>

    <!-- Timeline -->
    <div id="timeline"></div>

    <!-- Standard Timeline (Ordered List) -->
    <div class="standard-timeline">
      <h2>Key Events Timeline</h2>
      <ol id="standardTimeline"></ol>
    </div>
  </div>

  <!-- Modal for Event Details -->
  <div class="modal-overlay" id="modalOverlay"></div>
  <div class="event-details-modal" id="eventModal">
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle"></h2>
      <span class="close-modal" onclick="closeEventDetails()">&times;</span>
    </div>
    <p class="modal-date" id="modalDate"></p>
    <p class="modal-description" id="modalDescription"></p>
    <p id="modalCategory"></p>
  </div>

  <!-- Theme Toggle Button -->
  <button id="themeToggle" style="position:fixed; bottom:20px; right:20px; padding:10px; border-radius:50%; background:var(--primary); color:white; border:none; cursor:pointer; z-index: 1001;">
    <i class="fas fa-moon"></i>
  </button>

  <script>
    // Helper Functions
    function formatToISODate(date) {
      return date instanceof Date 
        ? date.toISOString().split('T')[0]
        : new Date(date).toISOString().split('T')[0];
    }

    // Use the original ISO string for display in the timeline list
    function formatDateForListDisplay(isoDate) {
      return isoDate;
    }

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Sample Timeline Data (or retrieve from localStorage)
    let timelineData = JSON.parse(localStorage.getItem('timelineEvents')) || [
      {
        id: 1,
        content: "Independence of Sri Lanka",
        start: "1948-02-04",
        description: "Sri Lanka gains independence from the British Empire.",
        category: "political"
      },
      {
        id: 2,
        content: "First Republican Constitution",
        start: "1972-05-22",
        description: "Sri Lanka becomes a republic and introduces a new constitution.",
        category: "political"
      },
      {
        id: 3,
        content: "D.S. Senanayake",
        start: "1947-09-24",
        description: "D.S. Senanayake is appointed as the first Prime Minister of Sri Lanka.",
        category: "political"
      },
      {
        id: 4,
        content: "Sirimavo Bandaranaike",
        start: "1960-07-21",
        description: "Appointment of the world’s first female Prime Minister.",
        category: "political"
      },
        {
        id: 5,
        content: "Dingiri Bandara Wijetunga",
        start: "1993-05-01",
        description: "Dingiri Banda Wijetunga, born on February 15, 1916, in Pilimathalawa, Udunuwara, was a prominent Sri Lankan politician who served as the country's fourth President from May 7, 1993, to November 12, 1994. Before his presidency, he held the position of Prime Minister from March 6, 1989, to May 7, 1993, under President Ranasinghe Premadasa. Following President Premadasa's assassination in 1993, Wijetunga, then Prime Minister, assumed the presidency. He was known for his simplicity and was affectionately referred to by his initials, 'DB,' which some expanded to 'Dearly Beloved.' He passed away on September 21, 2008.",
        category: "political"
      }, {
        id: 6,
        content: "Chandrika Kumaratunga",
        start: "1994-11-12",
        description: "",
        category: "political"
      }, {
        id: 7,
        content: "Mahinda Rajapaksa",
        start: "2005-11-19",
        description: "",
        category: "political"
      }, {
        id: 8,
        content: "Maithripala Sirisena",
        start: "2015-01-09",
        description: "",
        category: "political"
      }, {
        id: 9,
        content: "Gotabaya Rajapaksa",
        start: "2019-11-18",
        description: "",
        category: "political"
      }, {
        id: 10,
        content: "Ranil Wickremesinghe",
        start: "2022-07-14",
        description: "",
        category: "political"
      }, {
        id: 11,
        content: "Anura Kumara Dissanayake",
        start: "2024-09-23",
        description: "",
        category: "political"
      }
    ];

    // Initialize vis DataSet and Timeline
    let items = new vis.DataSet(timelineData);
    const timeline = new vis.Timeline(
      document.getElementById('timeline'),
      items,
      {
        min: formatToISODate(new Date('1945-01-01')),
        max: formatToISODate(new Date('2025-01-01')),
        locale: 'en-US',
        zoomMin: 1000 * 60 * 60 * 24 * 30,
        zoomMax: 1000 * 60 * 60 * 24 * 365 * 5,
        height: '500px'
      }
    );

    // Fuse.js Setup for Fuzzy Searching
    const fuseOptions = {
      keys: ['content', 'description'],
      threshold: 0.3,
      includeScore: true
    };
    let fuse = new Fuse(timelineData, fuseOptions);

    // Filter and Search Functionality
    function applyFilters() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      const category = document.getElementById('categoryFilter').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      let filteredData = timelineData;

      if (searchTerm !== "") {
        const fuseResults = fuse.search(searchTerm);
        filteredData = fuseResults.map(result => result.item);
      }

      if (category !== "") {
        filteredData = filteredData.filter(item => item.category === category);
      }

      if (startDate) {
        filteredData = filteredData.filter(item => item.start >= startDate);
      }
      if (endDate) {
        filteredData = filteredData.filter(item => item.start <= endDate);
      }

      timeline.setItems(new vis.DataSet(filteredData));
      renderStandardTimeline(filteredData);
    }

    const debouncedApplyFilters = debounce(applyFilters, 300);

    function resetSearchFilters() {
      document.getElementById('searchInput').value = "";
      document.getElementById('categoryFilter').selectedIndex = 0;
      document.getElementById('startDate').value = "";
      document.getElementById('endDate').value = "";
      applyFilters();
    }

    // Timeline Zoom and Reset Controls
    function zoomIn() {
      const currentWindow = timeline.getWindow();
      const duration = currentWindow.end - currentWindow.start;
      timeline.setWindow({
        start: new Date(currentWindow.start.getTime() + duration / 4),
        end: new Date(currentWindow.end.getTime() - duration / 4)
      });
    }

    function zoomOut() {
      const currentWindow = timeline.getWindow();
      const duration = currentWindow.end - currentWindow.start;
      timeline.setWindow({
        start: new Date(currentWindow.start.getTime() - duration / 2),
        end: new Date(currentWindow.end.getTime() + duration / 2)
      });
    }

    function resetView() {
      timeline.setWindow({
        start: new Date('1945-01-01'),
        end: new Date('2025-01-01')
      });
    }

    // Event Details Modal Functionality
    function showEventDetails(eventId) {
      const event = items.get(eventId);
      if (!event) return;

      document.getElementById('modalTitle').textContent = event.content;
      document.getElementById('modalDate').textContent = event.start;
      document.getElementById('modalDescription').textContent = event.description || 'No description available';
      document.getElementById('modalCategory').textContent = `Category: ${event.category || 'Unknown'}`;

      document.getElementById('modalOverlay').style.display = 'block';
      document.getElementById('eventModal').style.display = 'block';
    }

    function closeEventDetails() {
      document.getElementById('modalOverlay').style.display = 'none';
      document.getElementById('eventModal').style.display = 'none';
    }

    // Render the Standard Timeline as an Ordered List with ISO Date and clickable items
    function renderStandardTimeline(filteredItems = null) {
      const list = document.getElementById('standardTimeline');
      const itemsToRender = filteredItems || timelineData;
      
      list.innerHTML = itemsToRender
        .sort((a, b) => new Date(a.start) - new Date(b.start))
        .map(event => `
          <li onclick="showEventDetails(${event.id})">
            ${formatDateForListDisplay(event.start)} - ${event.content} ${event.category ? `<small>[${event.category}]</small>` : ''}
          </li>
        `).join('');
    }

    // Attach Event Listeners
    document.getElementById('searchInput').addEventListener('input', debouncedApplyFilters);
    document.getElementById('categoryFilter').addEventListener('change', applyFilters);
    document.getElementById('startDate').addEventListener('change', applyFilters);
    document.getElementById('endDate').addEventListener('change', applyFilters);

    timeline.on('select', function(properties) {
      if (properties.items && properties.items.length) {
        showEventDetails(properties.items[0]);
      }
    });

    document.getElementById('modalOverlay').addEventListener('click', closeEventDetails);

    // Theme Toggle Functionality
    let isDark = false;
    document.getElementById('themeToggle').addEventListener('click', () => {
      isDark = !isDark;
      document.body.setAttribute('data-theme', isDark ? 'dark' : '');
      document.getElementById('themeToggle').innerHTML = `<i class="fas ${isDark ? 'fa-sun' : 'fa-moon'}"></i>`;
    });

    // Initial Render of Standard Timeline
    window.onload = () => {
      renderStandardTimeline();
    };
  </script>
</body>
</html>
